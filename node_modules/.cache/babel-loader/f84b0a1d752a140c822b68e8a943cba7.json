{"ast":null,"code":"import { Matrix4, Object3D, Vector3 } from \"../../../build/three.module.js\";\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nvar CSS3DObject = function (element) {\n  Object3D.call(this);\n  this.element = element || document.createElement('div');\n  this.element.style.position = 'absolute';\n  this.element.style.pointerEvents = 'auto';\n  this.addEventListener('removed', function () {\n    this.traverse(function (object) {\n      if (object.element instanceof Element && object.element.parentNode !== null) {\n        object.element.parentNode.removeChild(object.element);\n      }\n    });\n  });\n};\n\n_c = CSS3DObject;\nCSS3DObject.prototype = Object.assign(Object.create(Object3D.prototype), {\n  constructor: CSS3DObject,\n  copy: function (source, recursive) {\n    Object3D.prototype.copy.call(this, source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n});\n\nvar CSS3DSprite = function (element) {\n  CSS3DObject.call(this, element);\n};\n\n_c2 = CSS3DSprite;\nCSS3DSprite.prototype = Object.create(CSS3DObject.prototype);\nCSS3DSprite.prototype.constructor = CSS3DSprite; //\n\nvar CSS3DRenderer = function () {\n  var _this = this;\n\n  var _width, _height;\n\n  var _widthHalf, _heightHalf;\n\n  var matrix = new Matrix4();\n  var cache = {\n    camera: {\n      fov: 0,\n      style: ''\n    },\n    objects: new WeakMap()\n  };\n  var domElement = document.createElement('div');\n  domElement.style.overflow = 'hidden';\n  this.domElement = domElement;\n  var cameraElement = document.createElement('div');\n  cameraElement.style.WebkitTransformStyle = 'preserve-3d';\n  cameraElement.style.transformStyle = 'preserve-3d';\n  cameraElement.style.pointerEvents = 'none';\n  domElement.appendChild(cameraElement);\n  var isIE = /Trident/i.test(navigator.userAgent);\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height) {\n    _width = width;\n    _height = height;\n    _widthHalf = _width / 2;\n    _heightHalf = _height / 2;\n    domElement.style.width = width + 'px';\n    domElement.style.height = height + 'px';\n    cameraElement.style.width = width + 'px';\n    cameraElement.style.height = height + 'px';\n  };\n\n  function epsilon(value) {\n    return Math.abs(value) < 1e-10 ? 0 : value;\n  }\n\n  function getCameraCSSMatrix(matrix) {\n    var elements = matrix.elements;\n    return 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(-elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(elements[6]) + ',' + epsilon(elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(-elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(-elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n  }\n\n  function getObjectCSSMatrix(matrix, cameraCSSMatrix) {\n    var elements = matrix.elements;\n    var matrix3d = 'matrix3d(' + epsilon(elements[0]) + ',' + epsilon(elements[1]) + ',' + epsilon(elements[2]) + ',' + epsilon(elements[3]) + ',' + epsilon(-elements[4]) + ',' + epsilon(-elements[5]) + ',' + epsilon(-elements[6]) + ',' + epsilon(-elements[7]) + ',' + epsilon(elements[8]) + ',' + epsilon(elements[9]) + ',' + epsilon(elements[10]) + ',' + epsilon(elements[11]) + ',' + epsilon(elements[12]) + ',' + epsilon(elements[13]) + ',' + epsilon(elements[14]) + ',' + epsilon(elements[15]) + ')';\n\n    if (isIE) {\n      return 'translate(-50%,-50%)' + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)' + cameraCSSMatrix + matrix3d;\n    }\n\n    return 'translate(-50%,-50%)' + matrix3d;\n  }\n\n  function renderObject(object, scene, camera, cameraCSSMatrix) {\n    if (object instanceof CSS3DObject) {\n      object.onBeforeRender(_this, scene, camera);\n      var style;\n\n      if (object instanceof CSS3DSprite) {\n        // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n        matrix.copy(camera.matrixWorldInverse);\n        matrix.transpose();\n        matrix.copyPosition(object.matrixWorld);\n        matrix.scale(object.scale);\n        matrix.elements[3] = 0;\n        matrix.elements[7] = 0;\n        matrix.elements[11] = 0;\n        matrix.elements[15] = 1;\n        style = getObjectCSSMatrix(matrix, cameraCSSMatrix);\n      } else {\n        style = getObjectCSSMatrix(object.matrixWorld, cameraCSSMatrix);\n      }\n\n      var element = object.element;\n      var cachedObject = cache.objects.get(object);\n\n      if (cachedObject === undefined || cachedObject.style !== style) {\n        element.style.WebkitTransform = style;\n        element.style.transform = style;\n        var objectData = {\n          style: style\n        };\n\n        if (isIE) {\n          objectData.distanceToCameraSquared = getDistanceToSquared(camera, object);\n        }\n\n        cache.objects.set(object, objectData);\n      }\n\n      element.style.display = object.visible ? '' : 'none';\n\n      if (element.parentNode !== cameraElement) {\n        cameraElement.appendChild(element);\n      }\n\n      object.onAfterRender(_this, scene, camera);\n    }\n\n    for (var i = 0, l = object.children.length; i < l; i++) {\n      renderObject(object.children[i], scene, camera, cameraCSSMatrix);\n    }\n  }\n\n  var getDistanceToSquared = function () {\n    var a = new Vector3();\n    var b = new Vector3();\n    return function (object1, object2) {\n      a.setFromMatrixPosition(object1.matrixWorld);\n      b.setFromMatrixPosition(object2.matrixWorld);\n      return a.distanceToSquared(b);\n    };\n  }();\n\n  function filterAndFlatten(scene) {\n    var result = [];\n    scene.traverse(function (object) {\n      if (object instanceof CSS3DObject) result.push(object);\n    });\n    return result;\n  }\n\n  function zOrder(scene) {\n    var sorted = filterAndFlatten(scene).sort(function (a, b) {\n      var distanceA = cache.objects.get(a).distanceToCameraSquared;\n      var distanceB = cache.objects.get(b).distanceToCameraSquared;\n      return distanceA - distanceB;\n    });\n    var zMax = sorted.length;\n\n    for (var i = 0, l = sorted.length; i < l; i++) {\n      sorted[i].element.style.zIndex = zMax - i;\n    }\n  }\n\n  this.render = function (scene, camera) {\n    var fov = camera.projectionMatrix.elements[5] * _heightHalf;\n\n    if (cache.camera.fov !== fov) {\n      if (camera.isPerspectiveCamera) {\n        domElement.style.WebkitPerspective = fov + 'px';\n        domElement.style.perspective = fov + 'px';\n      } else {\n        domElement.style.WebkitPerspective = '';\n        domElement.style.perspective = '';\n      }\n\n      cache.camera.fov = fov;\n    }\n\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    if (camera.isOrthographicCamera) {\n      var tx = -(camera.right + camera.left) / 2;\n      var ty = (camera.top + camera.bottom) / 2;\n    }\n\n    var cameraCSSMatrix = camera.isOrthographicCamera ? 'scale(' + fov + ')' + 'translate(' + epsilon(tx) + 'px,' + epsilon(ty) + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse) : 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse);\n    var style = cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n    if (cache.camera.style !== style && !isIE) {\n      cameraElement.style.WebkitTransform = style;\n      cameraElement.style.transform = style;\n      cache.camera.style = style;\n    }\n\n    renderObject(scene, scene, camera, cameraCSSMatrix);\n\n    if (isIE) {\n      // IE10 and 11 does not support 'preserve-3d'.\n      // Thus, z-order in 3D will not work.\n      // We have to calc z-order manually and set CSS z-index for IE.\n      // FYI: z-index can't handle object intersection\n      zOrder(scene);\n    }\n  };\n};\n\n_c3 = CSS3DRenderer;\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer };\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"CSS3DObject\");\n$RefreshReg$(_c2, \"CSS3DSprite\");\n$RefreshReg$(_c3, \"CSS3DRenderer\");","map":{"version":3,"sources":["/Users/muyangguo/Desktop/webgl/WebglPrototype/cybergraph/src/jsm/renderers/CSS3DRenderer.js"],"names":["Matrix4","Object3D","Vector3","CSS3DObject","element","call","document","createElement","style","position","pointerEvents","addEventListener","traverse","object","Element","parentNode","removeChild","prototype","Object","assign","create","constructor","copy","source","recursive","cloneNode","CSS3DSprite","CSS3DRenderer","_this","_width","_height","_widthHalf","_heightHalf","matrix","cache","camera","fov","objects","WeakMap","domElement","overflow","cameraElement","WebkitTransformStyle","transformStyle","appendChild","isIE","test","navigator","userAgent","getSize","width","height","setSize","epsilon","value","Math","abs","getCameraCSSMatrix","elements","getObjectCSSMatrix","cameraCSSMatrix","matrix3d","renderObject","scene","onBeforeRender","matrixWorldInverse","transpose","copyPosition","matrixWorld","scale","cachedObject","get","undefined","WebkitTransform","transform","objectData","distanceToCameraSquared","getDistanceToSquared","set","display","visible","onAfterRender","i","l","children","length","a","b","object1","object2","setFromMatrixPosition","distanceToSquared","filterAndFlatten","result","push","zOrder","sorted","sort","distanceA","distanceB","zMax","zIndex","render","projectionMatrix","isPerspectiveCamera","WebkitPerspective","perspective","autoUpdate","updateMatrixWorld","parent","isOrthographicCamera","tx","right","left","ty","top","bottom"],"mappings":"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","sourcesContent":["import {\n\tMatrix4,\n\tObject3D,\n\tVector3\n} from \"../../../build/three.module.js\";\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nvar CSS3DObject = function ( element ) {\n\n\tObject3D.call( this );\n\n\tthis.element = element || document.createElement( 'div' );\n\tthis.element.style.position = 'absolute';\n\tthis.element.style.pointerEvents = 'auto';\n\n\tthis.addEventListener( 'removed', function () {\n\n\t\tthis.traverse( function ( object ) {\n\n\t\t\tif ( object.element instanceof Element && object.element.parentNode !== null ) {\n\n\t\t\t\tobject.element.parentNode.removeChild( object.element );\n\n\t\t\t}\n\n\t\t} );\n\n\t} );\n\n};\n\nCSS3DObject.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: CSS3DObject,\n\n\tcopy: function ( source, recursive ) {\n\n\t\tObject3D.prototype.copy.call( this, source, recursive );\n\n\t\tthis.element = source.element.cloneNode( true );\n\n\t\treturn this;\n\n\t}\n\n} );\n\nvar CSS3DSprite = function ( element ) {\n\n\tCSS3DObject.call( this, element );\n\n};\n\nCSS3DSprite.prototype = Object.create( CSS3DObject.prototype );\nCSS3DSprite.prototype.constructor = CSS3DSprite;\n\n//\n\nvar CSS3DRenderer = function () {\n\n\tvar _this = this;\n\n\tvar _width, _height;\n\tvar _widthHalf, _heightHalf;\n\n\tvar matrix = new Matrix4();\n\n\tvar cache = {\n\t\tcamera: { fov: 0, style: '' },\n\t\tobjects: new WeakMap()\n\t};\n\n\tvar domElement = document.createElement( 'div' );\n\tdomElement.style.overflow = 'hidden';\n\n\tthis.domElement = domElement;\n\n\tvar cameraElement = document.createElement( 'div' );\n\n\tcameraElement.style.WebkitTransformStyle = 'preserve-3d';\n\tcameraElement.style.transformStyle = 'preserve-3d';\n\tcameraElement.style.pointerEvents = 'none';\n\n\tdomElement.appendChild( cameraElement );\n\n\tvar isIE = /Trident/i.test( navigator.userAgent );\n\n\tthis.getSize = function () {\n\n\t\treturn {\n\t\t\twidth: _width,\n\t\t\theight: _height\n\t\t};\n\n\t};\n\n\tthis.setSize = function ( width, height ) {\n\n\t\t_width = width;\n\t\t_height = height;\n\t\t_widthHalf = _width / 2;\n\t\t_heightHalf = _height / 2;\n\n\t\tdomElement.style.width = width + 'px';\n\t\tdomElement.style.height = height + 'px';\n\n\t\tcameraElement.style.width = width + 'px';\n\t\tcameraElement.style.height = height + 'px';\n\n\t};\n\n\tfunction epsilon( value ) {\n\n\t\treturn Math.abs( value ) < 1e-10 ? 0 : value;\n\n\t}\n\n\tfunction getCameraCSSMatrix( matrix ) {\n\n\t\tvar elements = matrix.elements;\n\n\t\treturn 'matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( - elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( elements[ 6 ] ) + ',' +\n\t\t\tepsilon( elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( - elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( - elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t}\n\n\tfunction getObjectCSSMatrix( matrix, cameraCSSMatrix ) {\n\n\t\tvar elements = matrix.elements;\n\t\tvar matrix3d = 'matrix3d(' +\n\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\tepsilon( elements[ 1 ] ) + ',' +\n\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\tepsilon( - elements[ 4 ] ) + ',' +\n\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\tepsilon( - elements[ 6 ] ) + ',' +\n\t\t\tepsilon( - elements[ 7 ] ) + ',' +\n\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\tepsilon( elements[ 9 ] ) + ',' +\n\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\tepsilon( elements[ 13 ] ) + ',' +\n\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\tepsilon( elements[ 15 ] ) +\n\t\t')';\n\n\t\tif ( isIE ) {\n\n\t\t\treturn 'translate(-50%,-50%)' +\n\t\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)' +\n\t\t\t\tcameraCSSMatrix +\n\t\t\t\tmatrix3d;\n\n\t\t}\n\n\t\treturn 'translate(-50%,-50%)' + matrix3d;\n\n\t}\n\n\tfunction renderObject( object, scene, camera, cameraCSSMatrix ) {\n\n\t\tif ( object instanceof CSS3DObject ) {\n\n\t\t\tobject.onBeforeRender( _this, scene, camera );\n\n\t\t\tvar style;\n\n\t\t\tif ( object instanceof CSS3DSprite ) {\n\n\t\t\t\t// http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n\t\t\t\tmatrix.copy( camera.matrixWorldInverse );\n\t\t\t\tmatrix.transpose();\n\t\t\t\tmatrix.copyPosition( object.matrixWorld );\n\t\t\t\tmatrix.scale( object.scale );\n\n\t\t\t\tmatrix.elements[ 3 ] = 0;\n\t\t\t\tmatrix.elements[ 7 ] = 0;\n\t\t\t\tmatrix.elements[ 11 ] = 0;\n\t\t\t\tmatrix.elements[ 15 ] = 1;\n\n\t\t\t\tstyle = getObjectCSSMatrix( matrix, cameraCSSMatrix );\n\n\t\t\t} else {\n\n\t\t\t\tstyle = getObjectCSSMatrix( object.matrixWorld, cameraCSSMatrix );\n\n\t\t\t}\n\n\t\t\tvar element = object.element;\n\t\t\tvar cachedObject = cache.objects.get( object );\n\n\t\t\tif ( cachedObject === undefined || cachedObject.style !== style ) {\n\n\t\t\t\telement.style.WebkitTransform = style;\n\t\t\t\telement.style.transform = style;\n\n\t\t\t\tvar objectData = { style: style };\n\n\t\t\t\tif ( isIE ) {\n\n\t\t\t\t\tobjectData.distanceToCameraSquared = getDistanceToSquared( camera, object );\n\n\t\t\t\t}\n\n\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t}\n\n\t\t\telement.style.display = object.visible ? '' : 'none';\n\n\t\t\tif ( element.parentNode !== cameraElement ) {\n\n\t\t\t\tcameraElement.appendChild( element );\n\n\t\t\t}\n\n\t\t\tobject.onAfterRender( _this, scene, camera );\n\n\t\t}\n\n\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\trenderObject( object.children[ i ], scene, camera, cameraCSSMatrix );\n\n\t\t}\n\n\t}\n\n\tvar getDistanceToSquared = function () {\n\n\t\tvar a = new Vector3();\n\t\tvar b = new Vector3();\n\n\t\treturn function ( object1, object2 ) {\n\n\t\t\ta.setFromMatrixPosition( object1.matrixWorld );\n\t\t\tb.setFromMatrixPosition( object2.matrixWorld );\n\n\t\t\treturn a.distanceToSquared( b );\n\n\t\t};\n\n\t}();\n\n\tfunction filterAndFlatten( scene ) {\n\n\t\tvar result = [];\n\n\t\tscene.traverse( function ( object ) {\n\n\t\t\tif ( object instanceof CSS3DObject ) result.push( object );\n\n\t\t} );\n\n\t\treturn result;\n\n\t}\n\n\tfunction zOrder( scene ) {\n\n\t\tvar sorted = filterAndFlatten( scene ).sort( function ( a, b ) {\n\n\t\t\tvar distanceA = cache.objects.get( a ).distanceToCameraSquared;\n\t\t\tvar distanceB = cache.objects.get( b ).distanceToCameraSquared;\n\n\t\t\treturn distanceA - distanceB;\n\n\t\t} );\n\n\t\tvar zMax = sorted.length;\n\n\t\tfor ( var i = 0, l = sorted.length; i < l; i ++ ) {\n\n\t\t\tsorted[ i ].element.style.zIndex = zMax - i;\n\n\t\t}\n\n\t}\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tvar fov = camera.projectionMatrix.elements[ 5 ] * _heightHalf;\n\n\t\tif ( cache.camera.fov !== fov ) {\n\n\t\t\tif ( camera.isPerspectiveCamera ) {\n\n\t\t\t\tdomElement.style.WebkitPerspective = fov + 'px';\n\t\t\t\tdomElement.style.perspective = fov + 'px';\n\n\t\t\t} else {\n\n\t\t\t\tdomElement.style.WebkitPerspective = '';\n\t\t\t\tdomElement.style.perspective = '';\n\n\t\t\t}\n\n\t\t\tcache.camera.fov = fov;\n\n\t\t}\n\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\tif ( camera.isOrthographicCamera ) {\n\n\t\t\tvar tx = - ( camera.right + camera.left ) / 2;\n\t\t\tvar ty = ( camera.top + camera.bottom ) / 2;\n\n\t\t}\n\n\t\tvar cameraCSSMatrix = camera.isOrthographicCamera ?\n\t\t\t'scale(' + fov + ')' + 'translate(' + epsilon( tx ) + 'px,' + epsilon( ty ) + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse ) :\n\t\t\t'translateZ(' + fov + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse );\n\n\t\tvar style = cameraCSSMatrix +\n\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n\t\tif ( cache.camera.style !== style && ! isIE ) {\n\n\t\t\tcameraElement.style.WebkitTransform = style;\n\t\t\tcameraElement.style.transform = style;\n\n\t\t\tcache.camera.style = style;\n\n\t\t}\n\n\t\trenderObject( scene, scene, camera, cameraCSSMatrix );\n\n\t\tif ( isIE ) {\n\n\t\t\t// IE10 and 11 does not support 'preserve-3d'.\n\t\t\t// Thus, z-order in 3D will not work.\n\t\t\t// We have to calc z-order manually and set CSS z-index for IE.\n\t\t\t// FYI: z-index can't handle object intersection\n\t\t\tzOrder( scene );\n\n\t\t}\n\n\t};\n\n};\n\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer };\n"]},"metadata":{},"sourceType":"module"}